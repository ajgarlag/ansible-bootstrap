---
# tasks file for ajgarlag.bootstrap
- name: installing bootstrap packages
  apt:
    pkg: "{{ item }}"
    state: latest
    update_cache: yes
    cache_valid_time: 86400
  with_items: ajgarlag_bootstrap_packages

- name: setting up current user authorized key
  authorized_key:
    user: "{{ ajgarlag_bootstrap_ssh_key_user }}"
    key: "{{ lookup('file', '~/.ssh/id_rsa.pub') }}"
  when: ajgarlag_bootstrap_add_current_user_key

- name: setting up extra authorized keys
  authorized_key:
    user: "{{ ajgarlag_bootstrap_ssh_key_user }}"
    key: "{{ item }}"
  with_items: ajgarlag_bootstrap_extra_authorized_keys

- name: allowing SSH connections
  ufw:
    rule: allow
    proto: tcp
    port: 22

- name: enabling ufw
  ufw:
    state: enabled
  when: ajgarlag_bootstrap_ufw_enable
